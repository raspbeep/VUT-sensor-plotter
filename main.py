from matplotlib import pyplot as plt
import numpy as np
from qppg import q_ppg
from pyampd.ampd import find_peaks

times = []
# values_red = []
values_ir = []
#
# with open('out5.txt', 'r') as f:
#     data = f.readlines()
#     data = [line for line in data if "app" in line
#             and "HERE" not in line and "Temperature" not in line
#             and "temperature" not in line]
#     for line in data:
#         line = line.strip().split(" app: ")
#         line = line[1].split(" ")
#
#         nums = [int(i, base=16) for i in line]
#         try:
#             values_red.append(nums[0])
#             values_ir.append(nums[1])
#         except Exception:
#             print(line)


values_red = [
    41373, 41379, 41457, 41428, 41500, 41546, 41573, 41582, 41482, 41260, 40938, 40638, 40387, 40291, 40265, 40300, 40384, 40434, 40501, 40543, 40573, 40666, 40731, 40753, 40793, 40762, 40738, 40777, 40761, 40747, 40789, 40850, 40876, 40988, 41005, 41065, 41118, 41154, 41183, 41202, 41218, 41247, 41249, 41293, 41344, 41315, 41345, 41403, 41417, 41479, 41500, 41502, 41475, 41142, 40869, 40602, 40330, 40292, 40263, 40310, 40418, 40484, 40524, 40598, 40640, 40743, 40740, 40787, 40834, 40848, 40804, 40818, 40776, 40825, 40838, 40890, 40971, 41005, 41083, 41119, 41142, 41193, 41225, 41286, 41295, 41311, 41340, 41373, 41346, 41363, 41433, 41453, 41482, 41481, 41512, 41468, 41332, 41068, 40761, 40514, 40386, 40349, 40388, 40449, 40551, 40611, 40690, 40762, 40849, 40910, 40936, 40890, 40852, 40831, 40779, 40809, 40816, 40855, 40889, 40972, 41000, 41056, 41116, 41147, 41155, 41204, 41249, 41260, 41296, 41318, 41304, 41358, 41340, 41412, 41404, 41458, 41486, 41449, 41287, 41001, 40695, 40411, 40269, 40241, 40266, 40308, 40406, 40497, 40515, 40585, 40639, 40723, 40717, 40731, 40721, 40719, 40728, 40721, 40725, 40755, 40780, 40856, 40932, 40971, 41009, 41081, 41113, 41157, 41188, 41194, 41189, 41225, 41196, 41217, 41215, 41230, 41269, 41270, 41288, 41350, 40515, 41404, 41383, 41254, 40995, 40661, 40368, 40195, 40121, 40124, 40199, 40277, 40363, 40424, 40476, 40544, 40613, 40666, 40722, 40723, 40721, 40714, 40656, 40692, 40730, 40758, 40827, 40886, 40926, 40952, 40997, 41051, 41115, 41146, 41123, 41199, 41238, 41231, 41276, 41305, 41318, 41334, 41359, 41386, 41434, 41456, 41505, 41541, 41551, 41513, 41445, 41169, 40861, 40553, 40320, 40275, 40296, 40342, 40448, 40513, 40610, 40689, 40744, 40818, 40855, 40851, 40843, 40811, 40798, 40776, 40776, 40807, 40891, 40936, 40953, 41016, 41045, 41126, 41172, 41178, 41229, 41237, 41274, 41283, 41298, 41355, 41365, 41410, 41405, 41418, 41400, 41337, 41112, 40802, 40513, 40347, 40283, 40311, 40376, 40474, 40526, 40601, 40683, 40740, 40820, 40846, 40849, 40824, 40803, 40789, 40782, 40759, 40821, 40880, 40909, 40989, 41029, 41077, 41136, 41177, 41236, 41225, 41266, 41288, 41301, 41337, 41346, 41365, 41382, 41392, 41442, 41453, 41499, 41458, 41269, 40991, 40661, 40352, 40190, 40149, 40189, 40258, 40358, 40409, 40467, 40510, 40555, 40620, 40684, 40652, 40663, 40666, 40670, 40649, 40641, 40722, 40766, 40752, 40797, 40867, 40966, 40976, 41010, 41048, 41069, 41099, 41131, 41140, 41152, 41165, 41219, 41218, 41228, 41292, 41316, 41335, 41376, 41340, 41259, 41027, 40713, 40401, 40223, 40162, 40175, 40232, 40348, 40463, 40515, 40555, 40580, 40664, 40678, 40697, 40673, 40635, 40597, 40641, 40634, 40675, 40710, 40754, 40818, 40850, 40896, 40931, 40960, 41006, 41023, 41023, 41046, 41089, 41119, 41179, 41172, 41206, 41208, 41238, 41069, 40815, 40508, 40239, 40114, 40050, 40089, 40162, 40257, 40331, 40398, 40484, 40531, 40599, 40660, 40651, 40638, 40557, 40581, 40556, 40602, 40625, 40644, 40755, 40780, 40801, 40837, 40912, 40933, 40944, 40970, 40992, 41005, 41055, 41079, 41054, 41117, 41142, 41177, 41176, 41174, 41160, 41012, 40724, 40370, 40062, 39836, 39794, 39836, 39904, 39972, 40042, 40084, 40139, 40196, 40263, 40315, 40361, 40384, 40389, 40401, 40413, 40398, 40392, 40443, 40527, 40557, 40619, 40670, 40721, 40771, 40805, 40819, 40862, 40888, 40912, 40938, 40928, 40939, 40965, 41002, 41037, 41075, 41106, 41117, 41099, 40936, 40663, 40332, 40053, 39956, 39909, 39994, 40045, 40157, 40231, 40288, 40310, 40392, 40452, 40492, 40508, 40455, 40452, 40448, 40438, 40440, 40496, 40511, 40566, 40624, 40691, 40714, 40746, 40780, 40816, 40874, 40867, 40887, 40900, 40925, 40953, 40989, 41051, 41050, 41085, 41053, 40878, 40588, 40319, 40093, 39997, 39975, 40013, 40104, 40209, 40295, 40303, 40368, 40438, 40505, 40532, 40556, 40527, 40518, 40480, 40499, 40516, 40544, 40588, 40626, 40681, 40708, 40785, 40836, 40869, 40871, 40921, 40934, 40985, 40998, 41002, 41036, 41069, 41106, 41148, 41186, 41241, 41277, 41306, 41260, 41110, 40832, 40482, 40206, 40051, 40037, 40091, 40140, 40244, 40316, 40356, 40379, 40429, 40484, 40539, 40571, 40562, 40588, 40576, 40535, 40565, 40601, 40631, 40689, 40712, 40788, 40857, 40892, 40920, 40959, 40974
]

values_red = values_red
values_ir = values_ir[:450]

x_red = np.arange(len(values_red))
x_ir = np.arange(len(values_ir))

# print("{", end='')
# for i in values_red:
#     print(i, end=', ')
# print("}", end='')
# print(len(values_red))
# print(values_red)


# peaks_red = q_ppg(values_red)
peaks_red = [14, 58, 101, 180, 235, 276, 319, 363, 403, 445, 489, 530, 569]
peaks_red_x = [values_red[i] for i in peaks_red]
print("number of peaks: ", len(peaks_red))
len_s = len(values_red) / 90
len_m = len_s / 60
portion_m = 1 / len_m

print("peaks: ", peaks_red)
print("Est HR: ", len(peaks_red) * portion_m)

# peaks_ir = q_ppg(values_ir)
# peaks_ir_x = [values_ir[i] for i in peaks_ir]

plt.plot(x_red, values_red, label="red")
# plt.plot(x_ir, values_ir, label="ir")
plt.legend()

plt.plot(peaks_red, peaks_red_x, 'r+')
# plt.plot(peaks_ir, peaks_ir_x, 'b+')
plt.show()
